# Place all the behaviors and hooks related to the matching controller here.
# All this logic will automatically be available in application.js.
# You can use CoffeeScript in this file: http://coffeescript.org/

@handleTopographies = ->
  levelCodes = <%= TopographyLookup.codes_between(100,199).pluck(:id) %>
  pancakeCodes = <%= TopographyLookup.codes_between(200,399).pluck(:id) %>
  raftCodes = <%= TopographyLookup.codes_between(400,499).pluck(:id) %>
  ridgeCodes = <%= TopographyLookup.codes_between(500,599).pluck(:id) %>

  disableField = (field) ->
    if $(field).data('selectize') isnt undefined
      $(field).data('selectize').clear()
      $(field).data('selectize').disable()
    else
      $(field).attr('disabled', true).val(null)

  enableField = (field) ->
    if $(field).data('selectize') isnt undefined
      $(field).data('selectize').enable()
    else
      $(field).removeAttr('disabled')


  group = $(this).parents('.topography-group')
  selectedValue = parseInt($(this).find('option:selected').val())
  switch
    when levelCodes.indexOf(selectedValue) >= 0
      # Disable all fields
      $(group).find('.ridge,.concentration').each (idx, el) ->
        disableField(el)
    when [].concat(pancakeCodes,raftCodes).indexOf(selectedValue) >= 0
      # Enable concentration
      # Disable all others
      enableField($(group).find(".concentration"))
      $(group).find(".ridge").each (idx, el) ->
        disableField(el)
    when ridgeCodes.indexOf(selectedValue) >= 0
      # Enable all fields
      $(group).find('.ridge,.concentration').each (idx, el) ->
        enableField(el)
    else
      # Shouldn't ever be here, disable everything
      $(group).find('.ridge,.concentration').each (idx,el) ->
        disableField(el)



$(document).on 'change', '.topography', handleTopographies
$(document).on 'ready page:load', ->
  $("select.topography").trigger('change')
