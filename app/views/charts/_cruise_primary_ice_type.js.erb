nv.addGraph(function() {
  var chart = nv.models.pieChart()
        .x(function(d) { console.log(d); return d.label })
        .y(function(d) { return d.value })
        .showLabels(true);
  var data = {
    key: 'Ice Type',
    values: [] 
  };
  
  <%- grouped_ice_obs =  observations_grouped_by_ice_type(@cruise.observations).as_json %>
  
  <%- grouped_ice_obs.each do |code, count| %>
    data.values.push({
      label: '<%= code %>',
      value: <%= count %>
    }); 
  <%- end %>
   
  var series = [data]; 
  
  d3.select("#<%= chart_id %> svg")
      .datum(series)
    .transition().duration(1200)
      .call(chart);
  
  return chart;
});