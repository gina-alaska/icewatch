nv.addGraph(function() {
  var series = <%= concentration_grouped_by_type(@cruise.observations).to_json.html_safe %>

  var chart = nv.models.stackedAreaChart()
              .x(function(d){return d[0]})
              .y(function(d){return d[1]}).clipEdge(true);

  chart.xAxis.axisLabel('Date/Time').tickFormat(function(d){ 
    return d3.time.format('%x')(new Date(d));

  });

  chart.yAxis.axisLabel('Total Concentration').tickFormat(d3.format(',f'));
  chart.stacked.forceY([0,10]);

  d3.select('#<%= chart_id %> svg')
    .datum(series)
    .transition().duration(500)
    .call(chart);

  nv.utils.windowResize(chart.update);

  return chart;
});